<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Nextcloud file picker demo</title>
</head>
<body>
    <header>
    </header>
    <main>
        <h1>Nextcloud file picker</h1>
        <input id="url" type="text" value="https://localhost/dev/server">
        <input id="login" type="text" value="julien">
        <input id="password" type="password" value="Nm8cC-kHczM-HGz55-S9SE2-Frf4F">
        <hr>
        <div id="mount_point"></div>

        <button id="selectButton">select file!</button>
    </main>
	<footer style="position: absolute; bottom: 0;">
		Generated at Thu Oct 29 23:58:44 UTC 2020
	</footer>
</body>
<script src="../js/filePickerWrapper.js"></script>
<script>
    const initialUrl = document.getElementById('url').value
    const initialLogin = document.getElementById('login').value
    const initialPassword = document.getElementById('password').value

    const filepicker = window.createFilePicker('mount_point', initialUrl, initialLogin, initialPassword)

    // monitor value change
    document.getElementById('login').addEventListener('input', function(e) {
        filepicker.updateLogin(e.target.value)
    })

    document.getElementById('selectButton').addEventListener('click', function(e) {
        filepicker.getFilesPath()
    })

    document.addEventListener('getFilesPath', function(e) {
        console.log('no vue, received "getFilesPath" event')
        console.debug(e.detail)
    })

    document.addEventListener('getSaveFilePath', function(e) {
        console.log('no vue, received "getSaveFilePath" event')
        console.debug(e.detail)
    })

    document.addEventListener('uploadPathLinkGenerated', function(e) {
        console.log('no vue, received "uploadPathLinkGenerated" event')
        console.debug(e.detail)
    })

    document.addEventListener('getFilesLink', function(e) {
        console.log('no vue, received "getFilesLink" event')
        console.debug(e.detail)
    })

    document.addEventListener('filesUploaded', function(e) {
        console.log('no vue, received "filesUploaded" event')
        console.debug(e.detail)
    })

    document.addEventListener('filesDownloaded', function(e) {
        const files = e.detail
        console.debug('no vue, something was downloaded')
        files.forEach(file => {
            console.debug('File : ' + file.name)
            console.debug(file)
            const reader = new FileReader()
            reader.readAsText(file)
            reader.onload = function() {
                console.debug(reader.result)
            }
            reader.onerror = function() {
                console.error('Impossible to read downloaded file')
                console.debug(reader.error)
            }
        })
    })
</script>
